#!/usr/bin/env python3
"""
äº¤äº’å¯ç”¨æ€§æ£€æŸ¥ - Prompt æ¨¡æ¿ç”Ÿæˆå™¨

è¿™ä¸ª skill ä¸º Claude Agent æä¾›äº¤äº’å¯ç”¨æ€§è¯„å®¡çš„æ ‡å‡†åŒ–æŒ‡å—ã€‚
Agent ä½¿ç”¨è‡ªèº«çš„è§†è§‰èƒ½åŠ›åˆ†æè®¾è®¡ç¨¿ï¼Œä½¿ç”¨æ–‡ä»¶è¯»å–èƒ½åŠ›æŸ¥æ‰¾å†å²æ¡ˆä¾‹ã€‚

çŸ¥è¯†åº“ç›®å½•ç»“æ„ï¼š
  knowledge_base/
  â”œâ”€â”€ design_decisions/      # å†å²è®¾è®¡å†³ç­–ï¼ˆæŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç±»ï¼‰
  â”‚   â”œâ”€â”€ 001-login-page-fullscreen-input.md
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ design_guidelines/     # è®¾è®¡è§„èŒƒ
  â”‚   â”œâ”€â”€ interaction-guidelines.md   # äº¤äº’è§„èŒƒ
  â”‚   â””â”€â”€ visual-guidelines.md        # è§†è§‰è§„èŒƒ
  â”œâ”€â”€ case_studies/          # å†å²æ¡ˆä¾‹ï¼ˆæŒ‰é—®é¢˜ç±»å‹åˆ†ç±»ï¼‰
  â”‚   â””â”€â”€ ...
  â””â”€â”€ user_feedback/         # ç”¨æˆ·åé¦ˆ
      â””â”€â”€ ...
"""

import sys
import json


# ============================================================================
# è¯„å®¡ç»´åº¦å®šä¹‰
# ============================================================================

REVIEW_DIMENSIONS = """
## äº¤äº’å¯ç”¨æ€§æ£€æŸ¥ç»´åº¦

### 1. åŠŸèƒ½å…¥å£ - ç”¨æˆ·è®¤çŸ¥æ¨¡å‹åŒ¹é…åº¦
- åŠŸèƒ½å…¥å£çš„ä½ç½®æ˜¯å¦ç¬¦åˆç”¨æˆ·é¢„æœŸï¼Ÿ
- å…¥å£çš„è§†è§‰å‘ˆç°æ˜¯å¦æ¸…æ™°å¯è¯†åˆ«ï¼Ÿ
- ç”¨æˆ·èƒ½å¦å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„åŠŸèƒ½ï¼Ÿ
- å…¥å£æ ‡ç­¾/å›¾æ ‡çš„å«ä¹‰æ˜¯å¦æ˜ç¡®ï¼Ÿ

### 2. æ“ä½œè·¯å¾„ - å¿ƒæ™ºæ¨¡å‹ä¸æ–­ç‚¹æ£€æµ‹
- æ“ä½œæµç¨‹æ˜¯å¦ç¬¦åˆç”¨æˆ·çš„è‡ªç„¶æ€è€ƒæ–¹å¼ï¼Ÿ
- ä»»åŠ¡å®Œæˆè·¯å¾„æ˜¯å¦è¿è´¯ï¼Œæœ‰æ— æ–­ç‚¹æˆ–è·³è½¬æ··ä¹±ï¼Ÿ
- æ­¥éª¤æ•°é‡æ˜¯å¦åˆç†ï¼Œæœ‰æ— å†—ä½™æ“ä½œï¼Ÿ
- å…³é”®æ“ä½œæ˜¯å¦å¯é€†æˆ–å¯ä¿®æ”¹ï¼Ÿ

### 3. äº¤äº’ä¸€è‡´æ€§ - å¹³å°è§„èŒƒç¬¦åˆåº¦
- äº¤äº’æ¨¡å¼æ˜¯å¦ç¬¦åˆ iOS HIG / Android Material Designï¼Ÿ
- ç›¸åŒç±»å‹çš„æ“ä½œæ˜¯å¦é‡‡ç”¨ä¸€è‡´çš„äº¤äº’æ–¹å¼ï¼Ÿ
- æ‰‹åŠ¿æ“ä½œæ˜¯å¦ä¸å¹³å°æƒ¯ä¾‹ä¸€è‡´ï¼Ÿ
- æ§ä»¶ä½¿ç”¨æ˜¯å¦ç¬¦åˆå¹³å°æ ‡å‡†ï¼Ÿ

### 4. çŠ¶æ€åé¦ˆ - æ“ä½œç¡®è®¤å……åˆ†åº¦
- æ“ä½œåæ˜¯å¦æœ‰æ˜ç¡®çš„çŠ¶æ€åé¦ˆï¼Ÿ
- åŠ è½½ã€æˆåŠŸã€å¤±è´¥ç­‰çŠ¶æ€æ˜¯å¦æ¸…æ™°å±•ç¤ºï¼Ÿ
- ç ´åæ€§æ“ä½œæ˜¯å¦æœ‰äºŒæ¬¡ç¡®è®¤ï¼Ÿ
- è¿›åº¦ä¿¡æ¯æ˜¯å¦é€æ˜å¯é¢„æœŸï¼Ÿ

### 5. è®¤çŸ¥è´Ÿè· - å¤æ‚åº¦æ§åˆ¶
- å•é¡µé¢/å•æ­¥éª¤çš„ä¿¡æ¯é‡æ˜¯å¦è¿‡è½½ï¼Ÿ
- é€‰é¡¹å’Œå†³ç­–ç‚¹æ˜¯å¦è¿‡å¤šï¼Ÿ
- æ˜¯å¦å­˜åœ¨è®°å¿†è´Ÿæ‹…è¿‡é‡çš„è®¾è®¡ï¼Ÿ
- æœ¯è¯­å’Œæ ‡ç­¾æ˜¯å¦æ˜“äºç†è§£ï¼Ÿ
"""

# ============================================================================
# é£é™©ç­‰çº§å®šä¹‰
# ============================================================================

RISK_LEVELS = """
## é£é™©ç­‰çº§åˆ¤å®šæ ‡å‡†

| ç­‰çº§ | æ ‡å‡† | å…¸å‹ç¤ºä¾‹ |
|------|------|----------|
| ğŸ”´ **é«˜** | ä¸¥é‡é˜»ç¢ç”¨æˆ·å®Œæˆæ ¸å¿ƒä»»åŠ¡ | å…³é”®æŒ‰é’®ä¸å¯ç‚¹å‡»ã€æµç¨‹æ–­è£‚æ— æ³•ç»§ç»­ã€æ— æ³•æäº¤è¡¨å• |
| ğŸŸ¡ **ä¸­** | å¢åŠ ç”¨æˆ·å›°æƒ‘æˆ–æ“ä½œæˆæœ¬ | å…¥å£ä½ç½®ä¸ç¬¦åˆé¢„æœŸã€ç¼ºå°‘çŠ¶æ€åé¦ˆã€éœ€è¦å¤šæ¬¡å°è¯• |
| ğŸŸ¢ **ä½** | å½±å“ä½“éªŒä½†ä¸é˜»ç¢ä»»åŠ¡å®Œæˆ | æ–‡æ¡ˆä¸å¤Ÿæ¸…æ™°ã€åŠ¨æ•ˆç¼ºå¤±ã€ç»†èŠ‚ä¸å¤Ÿç²¾è‡´ |
"""

# ============================================================================
# è¾“å‡ºæ ¼å¼æ¨¡æ¿
# ============================================================================

OUTPUT_TEMPLATE = """
## è¾“å‡ºæ ¼å¼è¦æ±‚

å¯¹äºå‘ç°çš„æ¯ä¸ªé—®é¢˜ï¼ŒæŒ‰ä»¥ä¸‹è¡¨æ ¼æ ¼å¼è¾“å‡ºï¼š

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **é—®é¢˜æè¿°** | [å…·ä½“æè¿°å‘ç°çš„é—®é¢˜] |
| **é£é™©ç­‰çº§** | ğŸ”´ é«˜ / ğŸŸ¡ ä¸­ / ğŸŸ¢ ä½ |
| **æ¶‰åŠé¡µé¢/å…ƒç´ ** | [å…·ä½“çš„é¡µé¢åç§°æˆ– UI å…ƒç´ ] |
| **å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“** | [è¯´æ˜è¯¥é—®é¢˜å¦‚ä½•å½±å“ç”¨æˆ·å®Œæˆä»»åŠ¡] |
| **æ”¹è¿›å»ºè®®** | [å¯æ“ä½œçš„æ”¹è¿›æ–¹æ¡ˆ] |

æœ€åç»™å‡ºæ€»ç»“ï¼š
- é«˜é£é™©é—®é¢˜ï¼šX ä¸ª
- ä¸­é£é™©é—®é¢˜ï¼šX ä¸ª
- ä½é£é™©é—®é¢˜ï¼šX ä¸ª
- ä¼˜å…ˆå¤„ç†å»ºè®®
"""

# ============================================================================
# çŸ¥è¯†åº“ç´¢å¼•
# ============================================================================

KNOWLEDGE_BASE_INDEX = """
## çŸ¥è¯†åº“å‚è€ƒ

åœ¨åˆ†æä¹‹å‰ï¼Œå¯ä»¥æŸ¥é˜…ä»¥ä¸‹çŸ¥è¯†åº“æ–‡ä»¶è·å–å‚è€ƒï¼š

### è®¾è®¡è§„èŒƒ
- `knowledge_base/design_guidelines/interaction-guidelines.md` - äº¤äº’è®¾è®¡è§„èŒƒ
- `knowledge_base/design_guidelines/visual-guidelines.md` - è§†è§‰è®¾è®¡è§„èŒƒ

### å†å²è®¾è®¡å†³ç­–
- `knowledge_base/design_decisions/` - æŒ‰ç¼–å·å­˜å‚¨çš„å†å²å†³ç­–
  - æ–‡ä»¶å‘½åæ ¼å¼: `XXX-åŠŸèƒ½å-å†³ç­–è¦ç‚¹.md`
  - ä½¿ç”¨ Grep æœç´¢å…³é”®è¯æŸ¥æ‰¾ç›¸å…³å†³ç­–

### å†å²æ¡ˆä¾‹
- `knowledge_base/case_studies/` - æˆåŠŸæ¡ˆä¾‹å’Œé—®é¢˜æ¡ˆä¾‹
  - å¯æŒ‰åŠŸèƒ½ç±»å‹ï¼ˆç™»å½•ã€åˆ—è¡¨ã€è¯¦æƒ…ç­‰ï¼‰æœç´¢

### ç”¨æˆ·åé¦ˆ
- `knowledge_base/user_feedback/` - æŒ‰æ—¶é—´å­˜å‚¨çš„ç”¨æˆ·åé¦ˆæ±‡æ€»
"""

# ============================================================================
# æ³¨æ„äº‹é¡¹
# ============================================================================

REVIEW_NOTES = """
## è¯„å®¡æ³¨æ„äº‹é¡¹

âš ï¸ **å¿…é¡»éµå®ˆ**ï¼š
1. ä»ä¸“ä¸šè§’åº¦å®¢è§‚åˆ†æï¼ŒåŸºäºè®¾è®¡åŸåˆ™å’Œç”¨æˆ·ä½“éªŒç†è®º
2. ä¸åšä¸»è§‚ç¾å­¦è¯„ä»·ï¼ˆå¦‚"æˆ‘è§‰å¾—ä¸å¥½çœ‹"ï¼‰
3. è¯†åˆ«å…·ä½“é—®é¢˜ï¼Œä¸ç»™ç»¼åˆè¯„åˆ†
4. æ¯ä¸ªé—®é¢˜éƒ½è¦ç»™å‡ºå¯æ“ä½œçš„æ”¹è¿›å»ºè®®
5. å¼•ç”¨è®¾è®¡è§„èŒƒæˆ–å†å²æ¡ˆä¾‹ä½œä¸ºä¾æ®

ğŸ’¡ **å»ºè®®**ï¼š
- å…ˆæŸ¥é˜… `interaction-guidelines.md` äº†è§£å…¬å¸äº¤äº’è§„èŒƒ
- æœç´¢çŸ¥è¯†åº“ä¸­ç±»ä¼¼åŠŸèƒ½çš„å†å²å†³ç­–
- ä¼˜å…ˆå…³æ³¨é«˜é£é™©é—®é¢˜
"""


def generate_prompt(
    design_context: str = "",
    core_task: str = "",
    specific_concerns: str = ""
) -> str:
    """
    ç”Ÿæˆäº¤äº’å¯ç”¨æ€§æ£€æŸ¥çš„å®Œæ•´ prompt
    
    Agent ä½¿ç”¨è¿™ä¸ª prompt ä½œä¸ºè¯„å®¡æŒ‡å—ï¼Œç»“åˆè‡ªèº«çš„è§†è§‰èƒ½åŠ›åˆ†æè®¾è®¡ç¨¿ã€‚
    """
    
    prompt = f"""# äº¤äº’å¯ç”¨æ€§è¯„å®¡ä»»åŠ¡

## è®¾è®¡èƒŒæ™¯ä¿¡æ¯

- **é¡µé¢/åŠŸèƒ½**: {design_context or "è¯·æ ¹æ®è®¾è®¡ç¨¿è¯†åˆ«"}
- **æ ¸å¿ƒä»»åŠ¡**: {core_task or "è¯·æ ¹æ®è®¾è®¡ç¨¿æ¨æ–­ç”¨æˆ·è¦å®Œæˆçš„ä¸»è¦ä»»åŠ¡"}
- **ç‰¹åˆ«å…³æ³¨**: {specific_concerns or "æ— ç‰¹åˆ«è¯´æ˜ï¼Œè¿›è¡Œå…¨é¢æ£€æŸ¥"}

---

{REVIEW_DIMENSIONS}

---

{RISK_LEVELS}

---

{OUTPUT_TEMPLATE}

---

{KNOWLEDGE_BASE_INDEX}

---

{REVIEW_NOTES}

---

## å¼€å§‹è¯„å®¡

è¯·åˆ†æè®¾è®¡ç¨¿ï¼ŒæŒ‰ç…§ä¸Šè¿°ç»´åº¦å’Œæ ¼å¼è¾“å‡ºè¯„å®¡ç»“æœã€‚
"""
    
    return prompt


def main():
    """ä¸»å‡½æ•°ï¼šä» stdin è¯»å–å‚æ•°ï¼Œè¾“å‡º prompt"""
    
    input_data = sys.stdin.read().strip()
    
    if not input_data:
        # æ— è¾“å…¥æ—¶è¿”å›é»˜è®¤ prompt
        result = {
            "success": True,
            "prompt": generate_prompt(),
            "usage": "å°†æ­¤ prompt ä¸è®¾è®¡ç¨¿å›¾ç‰‡ä¸€èµ·å‘é€ç»™ Agent è¿›è¡Œåˆ†æ"
        }
    else:
        try:
            params = json.loads(input_data)
            design_context = params.get("design_context", "")
            core_task = params.get("core_task", "")
            specific_concerns = params.get("specific_concerns", "")
            
            result = {
                "success": True,
                "prompt": generate_prompt(design_context, core_task, specific_concerns),
                "params": {
                    "design_context": design_context,
                    "core_task": core_task,
                    "specific_concerns": specific_concerns
                }
            }
        except json.JSONDecodeError as e:
            result = {
                "success": False,
                "error": f"JSON è§£æé”™è¯¯: {str(e)}",
                "usage": "è¾“å…¥æ ¼å¼: {\"design_context\": \"...\", \"core_task\": \"...\", \"specific_concerns\": \"...\"}"
            }
    
    print(json.dumps(result, ensure_ascii=False, indent=2))


if __name__ == "__main__":
    main()
