# Claude Agent SDK POC - ä»»åŠ¡æ¸…å•

## çŠ¶æ€è¯´æ˜
- â¬œ å¾…å¼€å§‹
- ğŸ”„ è¿›è¡Œä¸­
- âœ… å·²å®Œæˆ
- âŒ å·²å–æ¶ˆ/é˜»å¡

---

## é˜¶æ®µ 1ï¼šç¯å¢ƒå‡†å¤‡

- âœ… å®‰è£… claude-agent-sdk
  ```bash
  pip install claude-agent-sdk
  ```
  ç‰ˆæœ¬ï¼š0.1.6
- âœ… åˆ›å»º POC ç›®å½•ç»“æ„
- âœ… éªŒè¯ Claude Code CLI å·²æ†ç»‘

---

## é˜¶æ®µ 2ï¼šåŸºç¡€åŠŸèƒ½éªŒè¯

- âœ… éªŒè¯ query() åŸºç¡€æŸ¥è¯¢
- âœ… éªŒè¯ ClaudeSDKClient æµå¼å“åº”
- âœ… éªŒè¯ cwd å·¥ä½œç›®å½•éš”ç¦»
- âœ… éªŒè¯ system_prompt è®¾ç½®

---

## é˜¶æ®µ 3ï¼šå·¥å…·è°ƒç”¨éªŒè¯

- âœ… éªŒè¯ Read å·¥å…·
- âœ… éªŒè¯ Write å·¥å…·
- âœ… éªŒè¯ Bash å·¥å…·
- âœ… éªŒè¯ Grep å·¥å…·
- âœ… éªŒè¯ allowed_tools æƒé™æ§åˆ¶
- âœ… éªŒè¯ permission_mode è‡ªåŠ¨æˆæƒ

---

## é˜¶æ®µ 4ï¼šè‡ªå®šä¹‰å·¥å…· (MCP)

- âœ… åˆ›å»º @tool è£…é¥°å™¨ç¤ºä¾‹
- âœ… åˆ›å»º create_sdk_mcp_server ç¤ºä¾‹
- âœ… éªŒè¯å·¥å…·è¢« Claude è°ƒç”¨
- âœ… æ¨¡æ‹Ÿ Gerrit API å·¥å…· (get_review_stats, get_efficiency_trend)

---

## é˜¶æ®µ 5ï¼šSub-agent éªŒè¯

- âœ… å®šä¹‰ AgentDefinition ç¤ºä¾‹
- âœ… éªŒè¯å¤š Agent åä½œ
- âœ… éªŒè¯ Agent å·¥å…·éš”ç¦»

---

## é˜¶æ®µ 6ï¼šFastAPI é›†æˆ

- â¬œ åœ¨ FastAPI ç«¯ç‚¹ä¸­è°ƒç”¨ SDK
- â¬œ å®ç° SSE æµå¼å“åº”
- â¬œ å®ç°é”™è¯¯å¤„ç†

---

## é˜¶æ®µ 7ï¼šè‡ªå®šä¹‰ Gateway éªŒè¯

- âœ… æŸ¥é˜… SDK æºç ç¡®è®¤é…ç½®æ–¹å¼
- âœ… æµ‹è¯• llm-gateway.oppoer.me å…¼å®¹æ€§
- âœ… æ–‡æ¡£åŒ–é…ç½®æ–¹æ³•

**é…ç½®æ–¹æ³•**ï¼š
```python
# æ–¹å¼ 1ï¼šé€šè¿‡ env å‚æ•°
options = ClaudeAgentOptions(
    env={"ANTHROPIC_BASE_URL": "https://llm-gateway.oppoer.me"},
)

# æ–¹å¼ 2ï¼šé€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
# export ANTHROPIC_BASE_URL=https://llm-gateway.oppoer.me
# export ANTHROPIC_AUTH_TOKEN=your-token
```

---

## éªŒè¯ç»“æœè®°å½•

| éªŒè¯é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|-------|------|------|
| åŸºç¡€æŸ¥è¯¢ | âœ… | query() æ­£å¸¸å·¥ä½œ |
| å·¥å…·è°ƒç”¨ | âœ… | Read/Write/Bash/Grep å…¨éƒ¨æ­£å¸¸ |
| MCP å·¥å…· | âœ… | è‡ªå®šä¹‰å·¥å…·å¯è¢«è°ƒç”¨ |
| Sub-agent | âœ… | AgentDefinition æ”¯æŒå¤š Agent åä½œ |
| FastAPI | â¬œ | å¾…é›†æˆ |
| è‡ªå®šä¹‰ç½‘å…³ | âœ… | llm-gateway.oppoer.me å®Œå…¨å…¼å®¹ |

---

## é—®é¢˜è®°å½•

### 1. httpx ç‰ˆæœ¬å†²çª
**é—®é¢˜**ï¼šå®‰è£… claude-agent-sdk åï¼Œhttpx ç‰ˆæœ¬å‡çº§åˆ° 0.28.1ï¼Œä¸ supabase ç­‰åŒ…å†²çª
**å½±å“**ï¼šsupabase ç›¸å…³åŠŸèƒ½å¯èƒ½å—å½±å“
**è§£å†³æ–¹æ¡ˆ**ï¼šåç»­è€ƒè™‘è™šæ‹Ÿç¯å¢ƒéš”ç¦»æˆ–ç­‰å¾…ä¾èµ–æ›´æ–°

### 2. extra_args å‚æ•°æ ¼å¼
**é—®é¢˜**ï¼š`extra_args` å‚æ•°æ ¼å¼æœ‰è¯¯å¯¼è‡´æµ‹è¯•å¤±è´¥
**å½±å“**ï¼šæ— ï¼Œä¸æ˜¯å…³é”®åŠŸèƒ½
**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `env` å‚æ•°æˆ–ç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®

---

## ç»“è®º

### POC éªŒè¯ç»“æœï¼š**é€šè¿‡** âœ…

Claude Agent SDK å®Œå…¨æ»¡è¶³é¡¹ç›®éœ€æ±‚ï¼š

1. **åŸºç¡€åŠŸèƒ½**ï¼šquery() å’Œ ClaudeSDKClient æ­£å¸¸å·¥ä½œ
2. **å·¥å…·è°ƒç”¨**ï¼šå†…ç½®å·¥å…· (Read/Write/Bash/Grep) å…¨éƒ¨å¯ç”¨
3. **MCP è‡ªå®šä¹‰å·¥å…·**ï¼šå¯ä»¥é€šè¿‡ @tool è£…é¥°å™¨å®šä¹‰è‡ªå®šä¹‰å·¥å…·
4. **Sub-agent åä½œ**ï¼šAgentDefinition æ”¯æŒå®šä¹‰å¤šä¸ª Agent å¹¶è¿›è¡Œä»»åŠ¡å§”æ´¾
5. **è‡ªå®šä¹‰ API Gateway**ï¼šå®Œå…¨å…¼å®¹ llm-gateway.oppoer.me

### æ¨èä¸‹ä¸€æ­¥

1. **ç ”å‘æ•ˆèƒ½åˆ†æå®˜è¿ç§»**ï¼šå°†ç°æœ‰ agent_manager.py è¿ç§»åˆ° Agent SDK
2. **MCP å·¥å…·å°è£…**ï¼šå°† Gerrit API æŸ¥è¯¢ç­‰åŠŸèƒ½å°è£…ä¸º MCP å·¥å…·
3. **FastAPI é›†æˆ**ï¼šå®ç° SSE æµå¼å“åº”æ¥å£

---

## POC æ–‡ä»¶æ¸…å•

```
backend/poc/
â”œâ”€â”€ 01_basic_query.py      # åŸºç¡€æŸ¥è¯¢éªŒè¯ âœ…
â”œâ”€â”€ 02_tools.py            # å·¥å…·è°ƒç”¨éªŒè¯ âœ…
â”œâ”€â”€ 03_mcp_tools.py        # MCP è‡ªå®šä¹‰å·¥å…·éªŒè¯ âœ…
â”œâ”€â”€ 04_subagents.py        # Sub-agent éªŒè¯ âœ…
â”œâ”€â”€ 05_custom_gateway.py   # è‡ªå®šä¹‰ Gateway éªŒè¯ âœ…
â”œâ”€â”€ test_output.txt        # æµ‹è¯•è¾“å‡ºæ–‡ä»¶
â”œâ”€â”€ review_report.md       # MCP å·¥å…·ç”Ÿæˆçš„æŠ¥å‘Š
â””â”€â”€ analysis_summary.md    # Sub-agent ç”Ÿæˆçš„åˆ†ææ‘˜è¦
```

---

*POC å®Œæˆæ—¥æœŸï¼š2026-01-03*
