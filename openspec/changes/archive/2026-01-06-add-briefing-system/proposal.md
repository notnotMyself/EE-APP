# Proposal: Add Briefing System

## Change ID
`add-briefing-system`

## Summary
实现 AI 员工主动推送简报系统，让 AI 员工能够通过定时任务分析数据并向用户信息流推送高价值简报，而非只能被动回答问题。

## Motivation

### 问题背景
当前 AI 员工只能被动回答用户问题，无法：
- 主动监控数据并发现异常
- 持续跟踪长期任务
- 在发现重要信息时及时通知用户

这与产品定位"决策前哨站"和"让用户可以说'这件事我不管了，让 AI 帮我盯着'"相矛盾。

### 解决方案
建立简报推送系统：
1. **定时任务调度** - APScheduler 执行 AI 员工分析任务
2. **AI 二次判断** - 分析后由 AI 判断是否值得推送
3. **简报生成** - 生成简洁的卡片式简报（非长篇报告）
4. **信息流展示** - Flutter 端展示简报卡片，支持开始对话

### 信息流铁律（核心设计原则）
- 一天 ≤ 3 条
- 宁可不发，也不刷存在感
- 每一条都必须能接上对话

## Scope

### In Scope
- 数据库表：`briefings`、`scheduled_jobs`
- 后端服务：BriefingService、SchedulerService
- API 端点：简报列表、标记已读、开始对话、忽略简报
- Flutter 端：简报卡片组件、信息流页面
- AI 员工配置：简报生成指南

### Out of Scope
- WebSocket 实时推送（后续迭代）
- Push 通知（后续迭代）
- 简报分析报告的完整 PDF 导出

## Impact

### 用户价值
- 减少认知负担：不需要主动查看，AI 会在有价值时主动通知
- 快速决策：简报卡片3秒可读，点击可深入对话
- 任务托付：真正实现"把事情交给 AI 盯着"

### 技术影响
- 新增 APScheduler 依赖用于任务调度
- 新增 croniter 依赖用于 cron 表达式解析
- 需要在 main.py 中集成调度器生命周期管理

### Breaking Changes
无破坏性变更，为新增功能。

## Design Decisions

### 1. 简报 vs 报告
| 类型 | 用途 | 篇幅 |
|------|------|------|
| 简报 | 信息流卡片 | 标题 ≤30字，摘要 ≤100字 |
| 报告 | 深度分析 | MD 文档，按需生成 |

### 2. AI 二次判断机制
AI 执行分析后，使用专门的 prompt 判断是否值得推送：
- `importance_score > 0.6` 才会推送
- 每个 Agent 每天最多推送 3 条

### 3. 简报卡片结构
```
┌────────────────────────────────────────┐
│ 🤖 Agent名称  · 类型标签 ·  时间  🔴    │
├────────────────────────────────────────┤
│ 一句话标题（≤30字）                     │
│                                        │
│ 问题 + 影响 + 行动（≤100字）            │
│                                        │
│ ⚠️ 影响说明                            │
│                                        │
│ [深入分析]  [忽略]                      │
└────────────────────────────────────────┘
```

### 4. 简报类型与优先级
**类型 (BriefingType)**:
- `alert`: 警报（红色）
- `insight`: 洞察（紫色）
- `summary`: 摘要（蓝色）
- `action`: 待办（绿色）

**优先级 (BriefingPriority)**:
- `P0`: 紧急（红色）- 严重异常需立即关注
- `P1`: 重要（橙色）- 明显趋势需要关注
- `P2`: 普通（蓝色）- 发现可操作的机会

## Affected Specs
- 新增 `briefing-system` capability spec

## References
- 产品定位文档：`CLAUDE.md`
- 研发效能分析官配置：`backend/agents/dev_efficiency_analyst/CLAUDE.md`
