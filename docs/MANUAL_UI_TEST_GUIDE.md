# Flutter UI 手动测试指南

## 测试信息

- **测试环境**: 开发环境
- **后端地址**: http://localhost:8000
- **测试账号**: 1091201603@qq.com
- **测试密码**: eeappsuccess
- **测试日期**: 2026-01-22
- **测试范围**: P0功能完整性验证

---

## 测试前准备

### 1. 确认后端服务运行

```bash
# 1. 启动后端服务
cd /Users/80392083/develop/ee-app-pre-launch/backend/agent_orchestrator
python3 main.py

# 2. 验证健康检查
curl http://localhost:8000/health | jq .
# 应该返回: {"status": "healthy", "database": "connected"}
```

### 2. 启动Flutter应用

```bash
cd /Users/80392083/develop/ee-app-pre-launch/ai_agent_app

# 方式1: 真机/模拟器
flutter run

# 方式2: 指定设备
flutter devices
flutter run -d <device_id>

# 方式3: Chrome (Web版，仅用于快速调试)
flutter run -d chrome --web-port 8080
```

### 3. 测试工具准备

- **截图工具**: 准备好截图工具（设备截图 / Chrome DevTools）
- **网络工具**: 可选使用Charles/Proxyman抓包验证API调用
- **日志查看**: 保持终端开启查看Flutter logs

---

## 测试场景一：注册功能（P0-3）

### 目标
验证注册页面完整性和表单验证逻辑

### 测试步骤

#### 1.1 进入注册页面
- [ ] 打开应用，点击登录页的"注册"按钮
- [ ] 验证页面显示以下元素：
  - 标题："创建账户"
  - 副标题："请填写以下信息完成注册"
  - 邮箱输入框（带邮件图标）
  - **用户名输入框**（带人物图标）← **重点验证**
  - 密码输入框（带锁图标 + 显示/隐藏按钮）
  - 确认密码输入框（带锁图标 + 显示/隐藏按钮）
  - "注册"按钮
  - "已有账户？立即登录"链接

📸 **截图1**: 注册页面完整UI

#### 1.2 表单验证测试

| 测试用例 | 输入数据 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|---------|------|
| 邮箱格式错误 | `invalid-email` | 显示"请输入有效的邮箱地址" | | ⬜ |
| 邮箱为空 | 留空 | 显示"请输入邮箱" | | ⬜ |
| 用户名太短 | `ab` | 显示"用户名至少3个字符" | | ⬜ |
| 用户名太长 | `abcdefghij12345678901` (21字符) | 显示"用户名不能超过20个字符" | | ⬜ |
| 用户名非法字符 | `user@123` | 显示"用户名只能包含字母、数字、下划线" | | ⬜ |
| 密码太短 | `1234567` (7字符) | 显示"密码至少8个字符" | | ⬜ |
| 确认密码不一致 | 密码:`password123` 确认:`password456` | 显示"两次输入的密码不一致" | | ⬜ |

📸 **截图2**: 表单验证错误提示（至少2个不同场景）

#### 1.3 正常注册流程

- [ ] 输入有效数据：
  - 邮箱: `test_user_$(date +%s)@example.com` (使用时间戳避免重复)
  - 用户名: `test_user_$(date +%s)`
  - 密码: `TestPass123`
  - 确认密码: `TestPass123`
- [ ] 点击"注册"按钮
- [ ] 验证按钮显示加载状态（CircularProgressIndicator）
- [ ] 验证注册成功后：
  - 显示绿色SnackBar："注册成功！请登录"
  - 自动跳转到登录页面

📸 **截图3**: 注册成功提示（绿色SnackBar）

#### 1.4 重复注册测试

- [ ] 使用已存在的邮箱再次注册（例如：1091201603@qq.com）
- [ ] 验证显示红色SnackBar：显示错误提示（例如："注册失败: User already registered"）

📸 **截图4**: 重复邮箱错误提示

#### 1.5 密码显示/隐藏功能

- [ ] 点击密码输入框右侧的眼睛图标
- [ ] 验证密码从隐藏(●●●)切换为明文显示
- [ ] 再次点击，验证切换回隐藏状态
- [ ] 确认密码输入框同样测试

---

## 测试场景二：登录功能

### 目标
验证登录流程和错误处理

### 测试步骤

#### 2.1 正常登录
- [ ] 输入测试账号：
  - 邮箱: `1091201603@qq.com`
  - 密码: `eeappsuccess`
- [ ] 点击"登录"按钮
- [ ] 验证登录成功后的行为

📸 **截图5**: 登录成功后的页面（可能是协议页面或主页）

#### 2.2 错误密码测试
- [ ] 输入正确邮箱 + 错误密码
- [ ] 验证显示错误提示（红色SnackBar）
- [ ] 验证错误消息是中文且用户友好（例如："登录失败: Invalid login credentials"）

📸 **截图6**: 登录失败错误提示

#### 2.3 不存在的用户
- [ ] 输入不存在的邮箱
- [ ] 验证显示友好错误提示

---

## 测试场景三：隐私政策和用户协议（P0-2）

### 目标
验证首次登录强制显示协议页面

### 测试步骤

#### 3.1 首次登录用户（使用刚注册的账号）

- [ ] 使用测试场景一新注册的账号登录
- [ ] 验证自动跳转到"服务条款与隐私政策"页面
- [ ] 验证页面显示以下元素：
  - 标题："服务条款与隐私政策"
  - 副标题："在使用本应用前，请您仔细阅读并同意以下协议"
  - 两个可展开的卡片：
    - 📜 AI数字员工平台 隐私政策 (版本 1.0.0)
    - 📄 AI数字员工平台 服务条款 (版本 1.0.0)
  - 两个复选框（初始未勾选）
  - "同意并继续"按钮（初始禁用状态，灰色）

📸 **截图7**: 协议页面完整UI（折叠状态）

#### 3.2 展开协议内容

- [ ] 点击"隐私政策"卡片
- [ ] 验证卡片展开，显示Markdown格式的协议内容
- [ ] 验证可以滚动查看完整内容
- [ ] 验证展开后显示复选框："我已阅读并同意《AI数字员工平台 隐私政策》"
- [ ] 折叠后再展开"服务条款"，验证同样行为

📸 **截图8**: 协议展开状态（至少显示部分协议内容）

#### 3.3 复选框验证

- [ ] 只勾选一个复选框
- [ ] 验证"同意并继续"按钮仍然禁用（灰色）
- [ ] 勾选两个复选框
- [ ] 验证"同意并继续"按钮变为可用状态（蓝色高亮）

📸 **截图9**: 两个复选框都勾选后的状态

#### 3.4 同意并继续

- [ ] 点击"同意并继续"按钮
- [ ] 验证跳转到主页（Feed或Agents列表）
- [ ] **退出登录，重新登录同一账号**
- [ ] 验证**不再显示**协议页面，直接进入主页

📸 **截图10**: 同意后的主页

#### 3.5 已同意用户（使用测试账号）

- [ ] 使用测试账号 `1091201603@qq.com / eeappsuccess` 登录
- [ ] 验证直接进入主页，不显示协议页面（该账号应已同意协议）

---

## 测试场景四：全局错误处理（P0-1）

### 目标
验证各种错误场景的友好提示

### 测试步骤

#### 4.1 网络断开测试

**准备**: 断开设备网络连接（飞行模式 / 关闭WiFi）

- [ ] 尝试登录
- [ ] 验证显示中文错误提示（例如："网络连接失败，请检查您的网络设置"）
- [ ] 验证错误提示为红色SnackBar
- [ ] 验证错误消息**不包含**技术细节（如"SocketException"、"TimeoutException"等）

📸 **截图11**: 网络断开错误提示

**清理**: 恢复网络连接

#### 4.2 后端服务停止测试

**准备**: 在终端停止后端服务（Ctrl+C）

- [ ] 尝试登录或刷新Agent列表
- [ ] 验证显示友好错误提示（例如："服务连接失败，请稍后重试"）
- [ ] 验证不显示技术细节

📸 **截图12**: 后端停止错误提示

**清理**: 重新启动后端服务

#### 4.3 Token过期测试（可选，如果可以模拟）

- [ ] 手动删除本地Token或等待Token过期
- [ ] 尝试访问需要认证的页面
- [ ] 验证提示"身份验证失败，请重新登录"
- [ ] 验证自动跳转到登录页

---

## 测试场景五：Agent功能基础验证

### 目标
验证核心对话功能正常

### 测试步骤

#### 5.1 Agent列表

- [ ] 进入主页，查看Agent列表
- [ ] 验证显示4个Agent（根据后端健康检查返回的agents_loaded=4）
- [ ] 验证每个Agent卡片显示：
  - Avatar头像
  - Agent名称
  - Agent简介
  - 角色标签

📸 **截图13**: Agent列表页面

#### 5.2 进入对话页面

- [ ] 点击任意Agent（例如：Chris Chen - Design Validator）
- [ ] 验证进入对话页面
- [ ] 验证页面显示：
  - AppBar标题（Agent名称）
  - Agent介绍卡片（头像、名称、简介）
  - 快捷按钮行（例如："快速分析"、"设计评审"等）
  - 底部输入框 + 附件按钮 + 发送按钮

📸 **截图14**: Agent对话页面（空会话状态）

#### 5.3 发送消息

- [ ] 在输入框输入："你好，请介绍一下你的能力"
- [ ] 点击发送按钮
- [ ] 验证：
  - 用户消息立即显示在聊天区域
  - Agent开始响应（显示"正在思考..."或流式输出）
  - 消息以Markdown格式正确渲染
  - WebSocket连接正常（终端日志无连接错误）

📸 **截图15**: 对话中状态（显示用户消息和Agent响应）

#### 5.4 快捷按钮功能

- [ ] 点击任意快捷按钮（例如："快速分析"）
- [ ] 验证输入框自动填充预设文本
- [ ] 验证可以编辑后发送

---

## 测试场景六：UI美观度和用户体验

### 目标
评估整体UI质量和交互流畅度

### 检查项

#### 6.1 视觉一致性

- [ ] 所有页面使用统一的主题色
- [ ] 按钮样式一致（颜色、圆角、阴影）
- [ ] 输入框样式一致
- [ ] 字体大小层级清晰（标题、正文、说明文本）

#### 6.2 加载状态

- [ ] 所有异步操作显示加载指示器（CircularProgressIndicator）
- [ ] 加载指示器位置合理（按钮内 / 页面中央）
- [ ] 加载期间按钮禁用，防止重复点击

#### 6.3 交互反馈

- [ ] 按钮有点击效果（水波纹动画）
- [ ] 表单验证错误实时显示（离开焦点时）
- [ ] 成功/失败操作显示SnackBar（颜色区分：绿色/红色）
- [ ] SnackBar自动消失（3秒内）

#### 6.4 响应速度

- [ ] 页面切换流畅，无明显卡顿（< 300ms感知延迟）
- [ ] 消息发送后立即显示（乐观UI）
- [ ] 滚动列表流畅（60fps）

#### 6.5 文本和图标

- [ ] 所有文本为中文（无英文占位符）
- [ ] 图标语义清晰（邮件、人物、锁、眼睛等）
- [ ] 无文本截断或溢出问题

---

## 测试结果汇总

### 完成情况统计

| 测试场景 | 测试用例数 | 通过 | 失败 | 完成度 |
|---------|-----------|------|------|--------|
| 注册功能 | 9 | - | - | ⬜ |
| 登录功能 | 3 | - | - | ⬜ |
| 隐私政策 | 5 | - | - | ⬜ |
| 错误处理 | 3 | - | - | ⬜ |
| Agent功能 | 4 | - | - | ⬜ |
| UI体验 | 5 | - | - | ⬜ |
| **总计** | **29** | **-** | **-** | **-** |

### 发现的问题

| 编号 | 问题描述 | 严重程度 | 截图 | 状态 |
|------|---------|---------|------|------|
| 1 | | | | |
| 2 | | | | |
| 3 | | | | |

### 性能评估

| 指标 | 目标 | 实际 | 状态 |
|------|------|------|------|
| 应用启动时间 | < 3秒 | | ⬜ |
| 登录响应时间 | < 2秒 | | ⬜ |
| 页面切换流畅度 | 60fps | | ⬜ |
| 消息发送响应 | < 200ms | | ⬜ |
| 内存使用 | < 150MB | | ⬜ |

---

## 测试注意事项

### 1. 邮箱确认问题

**已知问题**: 本地环境无法发送邮箱确认链接

**临时解决方案**:
- 方式1: 在Supabase Dashboard手动确认用户邮箱
- 方式2: 直接在数据库更新 `auth.users.email_confirmed_at = NOW()`

```sql
-- 在Supabase SQL Editor执行
UPDATE auth.users
SET email_confirmed_at = NOW()
WHERE email = 'your-test-email@example.com';
```

### 2. 测试数据清理

测试完成后清理测试账号（可选）:

```sql
-- 删除测试用户
DELETE FROM auth.users WHERE email LIKE 'test_user_%@example.com';
```

### 3. 日志收集

测试过程中保存Flutter日志:

```bash
flutter run > test_logs.txt 2>&1
```

如遇到崩溃，日志将包含完整堆栈跟踪信息。

---

## 测试完成确认

- [ ] 所有29个测试用例已执行
- [ ] 至少15张截图已保存
- [ ] 发现的问题已记录（如有）
- [ ] 性能指标已测量
- [ ] 测试日志已保存
- [ ] 测试报告已更新

---

## 下一步行动

1. **如果测试通过**:
   - 更新 `PRE_LAUNCH_TEST_REPORT.md`，标记P0-5为"✅ 完成"
   - 将截图整理到 `docs/screenshots/` 目录
   - 准备合并 `feature/pre-launch-preparation` 分支到 `main`

2. **如果发现问题**:
   - 在Git创建新分支修复问题
   - 修复后重新测试
   - 更新测试报告

3. **生产配置准备**:
   - 按照 `PRODUCTION_CONFIG.md` 配置生产环境
   - 创建 `.env.production` 文件
   - 配置生产API URL
   - 执行生产数据库迁移

---

**测试负责人**: _____________

**测试日期**: 2026-01-22

**签名**: _____________
